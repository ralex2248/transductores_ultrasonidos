{% extends "home_base.html" %}
{% load static %}

{% block title %}
Experimento con Tiempo
{% endblock %}

{% block content %}

<!-- Add Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<div class="detail-container">
    <div class="experiment-data-card" style="float: left;">
        <div class="chart-card experiment-data-card">
            <div class="chart-title">
                <h2>Datos del Experimento</h2>
            </div>
            
            <div class="experiment-data">
                <p>Nombre del Experimento: {{ experimento.nombre_experimento }}</p>
                <p>Sensibilidad: {{ experimento.sensibilidad }}</p>
                <p>Pasos: {{ experimento.pasos }}</p>
                <p>Frecuencia inicial: {{ experimento.frecuencia_inicial }}</p>
                <p>Frecuencia final: {{ experimento.final_frecuency }}</p>
                <p>Voltaje: {{ experimento.voltaje }}</p>
                <p>Tiempo total: {{ tiempo_formateado }}</p>
                <p>Comentario: {{ experimento.comentario }}</p>
            </div>
            
        </div>
    </div>

    <div class="chart-container" style="float: left;">
        <div class="chart-card">
            <div class="chart-title">
                <h2>Gráfico f(z)</h2>
            </div>
            <!-- Canvas para el gráfico -->
            <canvas id="myChart" style="display: inline-block;"></canvas>
        </div>

        <div class="chart-card" style="display: inline-block;">
            <div class="chart-title">
                <h2>Gráfico Shift Phase</h2>
            </div>
            <!-- Canvas para el gráfico -->
            <canvas id="myChart2"></canvas>
        </div>
    </div>
</div>



<!-- Datos del gráfico -->
<div id="chartData" data-final-values="{{ final_values }}" data-frecuencies="{{ frecuencies }}" data-shift-phase="{{ shift_phase }}" style="display: none;"></div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    let chartDataDiv = document.getElementById('chartData');
    
    let finalValues = JSON.parse(chartDataDiv.getAttribute('data-final-values'));
    let frecuencies = JSON.parse(chartDataDiv.getAttribute('data-frecuencies'));
    let shift_phase = JSON.parse(chartDataDiv.getAttribute('data-shift-phase'));

    let minValue_2 = Math.min(...shift_phase);
    let maxValue_2= Math.max(...shift_phase);
    let margin_2 = (maxValue_2 - minValue_2) * 0.05;

    minValue_2 -= margin_2;
    maxValue_2 += margin_2;

    let minValue = Math.min(...finalValues);
    let maxValue = Math.max(...finalValues);
    let margin = (maxValue - minValue) * 0.05;
    


    minValue -= margin;
    maxValue += margin;

    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: frecuencies,
            datasets: [{
                label: 'Final Values',
                data: finalValues,
                fill: false,
                borderColor: 'rgba(0, 0, 255, 1)',
                tension: 0.1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: false,
                    min: minValue,
                    max: maxValue,
                    title: {
                        display: true,
                        text: 'f(z)'
                    }
                }
            },
            animation: {
                onComplete: function() {
                    // Función para ocultar el mensaje de carga, si aplica
                    function hideLoadingOverlay() {
    document.getElementById("loadingOverlay").style.display = "none";
}

                }
            }
        }
    });
    var ctx2 = document.getElementById('myChart2').getContext('2d');
    var myChart2 = new Chart(ctx2, {
        type: 'line',
        data: {
            labels: frecuencies,
            datasets: [{
                label: 'Shift phase',
                data: shift_phase,
                fill: false,
                borderColor: 'rgba(255, 0, 0, 1)',
                tension: 0.1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: false,
                    min: minValue_2,
                    max: maxValue_2,
                    title: {
                        display: true,
                        text: 'f(z)'
                    }
                }
            },
            animation: {
                onComplete: function() {
                    // Función para ocultar el mensaje de carga, si aplica
                    function hideLoadingOverlay() {
    document.getElementById("loadingOverlay").style.display = "none";
}

                }
            }
        }
    });
});

</script>

<style>
    .chart-container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        gap: 20px;
    }

    .chart-card {
        background: #ffffff;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 20px;
        margin-top: 50px;
        width: 640px; /* Ancho de la tarjeta */
        margin-left: 270px;
    }

    .chart-title {
        text-align: center;
    }

    #myChart {
        width: 600px;
        height: 500px;
    }

    #myChart2 {
        width: 600px;
        height: 500px;
    }

    .experiment-data-card {
        width: 320px; 
        margin-right: 20px; 
    }

    .experiment-data {
        padding: 20px;
        font-size: 16px;

    }
    .detail-container {
        display: flex;
    }




</style>

{% endblock %}
